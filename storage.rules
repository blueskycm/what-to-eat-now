rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    function isSignedIn() {
      return request.auth != null;
    }
    function isAdmin() {
      return isSignedIn() && request.auth.token.admin == true;
    }

    // 預設全部拒絕（保底）
    match /{allPaths=**} {
      allow read, write: if false;
    }

    // ── 行銷圖卡/素材（公開讀、僅 admin 可寫） ──
    match /marketing/{path=**} {
      allow read: if true;        // 任何人可讀（公開素材）
      allow write: if isAdmin();  // 僅 admin 後台可上傳/改刪
    }

    // ── 使用者上傳（可選，未用可留著） ──
    // 每位使用者只能操作自己 uid 目錄；admin 全權
    match /user_uploads/{uid}/{file=**} {
      allow read, write: if isAdmin() || (isSignedIn() && request.auth.uid == uid);
    }
  }
}
